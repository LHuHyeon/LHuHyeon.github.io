---
title: (3D RPG) ìºë¦­í„° ì»¤ìŠ¤í…€
author: LHH
date: 2023-07-7 00:00 GMT+0900
categories: [Portfolio, (3D Unity) MY_RPG]
tags: [Unity, Portfolio]
---

> êµ¬í˜„ ê¸°ê°„ : 07.06 ~ 07.06

ê²Œì„ì„ ì²˜ìŒ ì‹œì‘í•  ë•Œ ìºë¦­í„°ì˜ ì–¼êµ´ê³¼ ì˜·ì„ ê¾¸ë°€ ìˆ˜ ìˆëŠ” ì»¤ìŠ¤í…€ì„ êµ¬í˜„í•œë‹¤.

ì»¤ìŠ¤í…€ì— ì‚¬ìš©í•œ ì—ì…‹ì€ [POLYGON Modular Fantasy Hero Characters - Low Poly 3D Art by Synty](https://assetstore.unity.com/packages/3d/characters/humanoids/fantasy/polygon-modular-fantasy-hero-characters-low-poly-3d-art-by-synty-143468){:target="_blank"}ì´ë‹¤.

í•´ë‹¹ ì—ì…‹ì€ `SkinnedMeshRenderer`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜·ì„ ì…í ìˆ˜ ìˆë‹¤.

## ğŸ® êµ¬í˜„ ê¸°ëŠ¥
`ìºë¦­í„° ì»¤ìŠ¤í…€ Scene`ì—ì„œ ì»¤ìŠ¤í…€ì„ ì§„í–‰í•˜ê³  ì™„ë£Œë˜ë©´ `Game Scene`ìœ¼ë¡œ ì´ë™í•˜ë„ë¡ ë§Œë“¤ì—ˆë‹¤.

### ğŸ“ SkinnedData.cs
> ì°¸ê³  : [(Unity) SkinnedMeshRenderer íŒŒì¸  ë³€ê²½](/posts/Unity-SkinnedMeshRenderer-Change)

`SkinnedMeshRenderer`ë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•´ `SkinnedData`ë¥¼ ìƒì„±í•œë‹¤.
```cs
public class SkinnedData
{
    public Mesh sharedMesh;         // Mesh
    public Bounds bounds;           // íŒŒì¸  ìœ„ì¹˜
    public List<string> bones;      // ë¼ˆëŒ€ë“¤
    public string rootBoneName;     // ëŒ€í‘œ ë¼ˆëŒ€
}
```

`bones`, `rootBone`ì„ `string`ìœ¼ë¡œ ë°›ì€ ì´ìœ ëŠ” `Scene`ì´ ë„˜ì–´ê°€ëŠ” ê³¼ì •ì—ì„œ `Transform`ì´ ì‚¬ë¼ì§€ê¸° ë•Œë¬¸ì—

`Game Scene`ì—ì„œ ì´ë¦„ìœ¼ë¡œ ë¼ˆëŒ€ë¥¼ ì°¾ì•„ ë„£ì–´ì¤„ ê²ƒì´ë‹¤.

### ğŸ“ CharacterCustom.cs, UI_CustomScene.cs
ìºë¦­í„° ì»¤ìŠ¤í…€ì„ ì§„í–‰ í›„ `SkinnedData`ë¥¼ `GameManager`ì— ë„£ì–´ ì €ì¥í•œë‹¤.

### ğŸ“ PlayerController.cs
`Game Scene`ìœ¼ë¡œ ë¡œë“œë˜ë©´ í”Œë ˆì´ì–´ ì•ˆì—ì„œ `Start`í•  ë•Œ `SkinnedData`ë¥¼ ì°¾ì•„ ì ìš©í•´ì¤€ë‹¤.
```cs
void Start()
{
    SetInfo();
}

void SetInfo()
{
    // ìºë¦­í„° íŒŒì¸  ê°€ì ¸ì˜¤ê¸°
    GameObject goChild = Util.FindChild(gameObject, "Modular_Characters");
    foreach(Transform child in goChild.GetComponentsInChildren<Transform>())
    {
        // ìºë¦­í„°ì˜ ê¸°ë³¸ ë¶€ìœ„ ì €ì¥ (+ì–¼êµ´ ì»¤ìŠ¤í…€)
        if (child.CompareTag("Custom"))
        {
            string result = Regex.Replace(child.name, "Base", "");
            Define.DefaultPart partType = (Define.DefaultPart)System.Enum.Parse(typeof(Define.DefaultPart), result);

            SetSkinned(partType, child);
            continue;
        }
    }
}

// SkinnedMeshReaderer ë³€ê²½
void SetSkinned(Define.DefaultPart partType, Transform go)
{
    SkinnedMeshRenderer objSkinned = go.GetComponent<SkinnedMeshRenderer>();

    SkinnedData skinnedInfo = Managers.Game.DefaultPart[partType];
    objSkinned.sharedMesh = skinnedInfo.sharedMesh;
    objSkinned.localBounds = skinnedInfo.bounds;
    objSkinned.rootBone = FindChild<Transform>(rootBone, skinnedInfo.rootBoneName);

    Transform[] newBones = new Transform[skinnedInfo.bones.Count];
    for(int i=0; i<skinnedInfo.bones.Count; i++)
    {
        newBones[i] = FindChild<Transform>(rootBone, skinnedInfo.bones[i]);
    }
    
    objSkinned.bones = newBones;
}

public T FindChild<T>(GameObject go, string name = null) where T : UnityEngine.Object
{
    foreach(T component in go.GetComponentsInChildren<T>())
    {
        if (string.IsNullOrEmpty(name) || component.name == name)
            return component;
    }

    return null;
}
```

## ğŸ¬ êµ¬í˜„ ì˜ìƒ
![Custom](https://github.com/LHuHyeon/LHuHyeon.github.io/assets/110723307/47010e10-ed8a-40b5-913f-2810f03b0316)