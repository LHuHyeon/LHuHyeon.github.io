---
title: (3D RPG) í”Œë ˆì´ì–´ ê¸°ëŠ¥
author: LHH
date: 2023-05-12 00:00 GMT+0900
categories: [Portfolio, (3D Unity) MY_RPG]
tags: [Unity, Portfolio]
---

## êµ¬ë¥´ê¸° (íšŒí”¼)
ëª¬ìŠ¤í„°ì˜ ê³µê²©ì´ë‚˜ ë³´ìŠ¤ì˜ ê³µê²© íŒ¨í„´ì„ í”¼í•˜ê¸° ìœ„í•´ `êµ¬ë¥´ê¸°`ë¥¼ ì¶”ê°€í–ˆë‹¤.

## ì—°ì† ê³µê²©
ì²˜ìŒì— ì—°ì† ê³µê²©ì€ ìƒê°ë³´ë‹¤ êµ¬í˜„ì´ í—·ê°ˆë ¤ì„œ í•´ë§¸ì§€ë§Œ êµ¬í˜„ì€ ì„±ê³µí–ˆë‹¤..!

[ ì—°ì† ê³µê²©ì´ ë˜ëŠ” ê³¼ì • ] <br>
`ê³µê²©í‚¤ ì…ë ¥ -> ê³µê²© ì§„í–‰ -> ê³µê²© ì¤‘ì— ê³µê²©í‚¤ ì…ë ¥í•˜ëŠ”ì§€ ê³„ì† í™•ì¸ -> ê³µê²©í‚¤ë¥¼ ëˆ„ë¥´ë©´ ë‹¤ìŒ ê³µê²© ì§„í–‰ || ì•ˆëˆ„ë¥´ë©´ Idle`

```cs
float _attackCloseTime = 0;
// Stateê°€ Attackë©´ UpateAttack ê³„ì† í˜¸ì¶œ
protected override void UpdateAttack()
{
    _attackCloseTime += Time.deltaTime;

    // ê³µê²©ì´ ì‹œê°„ì´ ëë‚˜ë©´ ì¢…ë£Œ || ê³µê²©ì´ ëë‚¬ëŠ”ë° ë‹¤ë¥¸ ì• ë‹ˆë©”ì´ì…˜ì— ìˆë‹¤ë©´ ì¢…ë£Œ
    if ((anim.GetCurrentAnimatorStateInfo(0).IsTag("Attack") == true &&
        _attackCloseTime > 0.94f && _onComboAttack == false) || 
        (anim.GetCurrentAnimatorStateInfo(0).IsTag("Attack") == false &&
        _attackCloseTime > 0.99f && _onComboAttack == false))
    {
        StopAttack();
        State = Define.State.Idle;
        return;
    }

    dir = _destPos - transform.position;
    transform.rotation = Quaternion.Slerp(transform.rotation, Quaternion.LookRotation(dir), 20f * Time.deltaTime);
}

bool _onAttack = false;
bool _onComboAttack = false;
int attackClipNumber = 0;
string[] _attackClipList = new string[] {"ATTACK1", "ATTACK2"};
// ê³µê²©í‚¤ë¥¼ ëˆ„ë¥´ë©´ í˜¸ì¶œ
void OnAttack()
{
    // ì½¤ë³´ ì²´í¬
    if (_onAttack &&
        anim.GetCurrentAnimatorStateInfo(0).IsTag("Attack") &&
        anim.GetCurrentAnimatorStateInfo(0).normalizedTime >= 0.3f)
    {
        _onComboAttack = true;
    }

    // ê³µê²©!
    if (!_onAttack)
    {
        anim.CrossFade(_attackClipList[attackClipNumber], 0.1f, -1, 0);
        State = Define.State.Attack;

        _onAttack = true;
    }
}

// [ Anim Event ] ê³µê²© ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚˜ë©´ í˜¸ì¶œ
public void ExitAttack()
{
    // ê³µê²© ì¤‘ì— ê³µê²© í‚¤ë¥¼ ëˆŒë €ë‚˜?
    if (_onComboAttack == true)
    {
        if (attackClipNumber == 1)
            attackClipNumber = 0;
        else if (attackClipNumber == 0)
            attackClipNumber = 1;

        anim.CrossFade(_attackClipList[attackClipNumber], 0.1f, -1, 0);
        _onComboAttack = false;
    }
}

void StopAttack()
{
    _onAttack = false;
    _onComboAttack = false;
    _stopAttack = true;
    _attackCloseTime = 0;
    attackClipNumber = 0;
}
```

## ğŸ’» BaseController.cs
ì»¨íŠ¸ë¡¤ì´ í•„ìš”í•œ ìºë¦­í„°ëŠ” ëª¨ë‘ `BaseController.cs`ë¥¼ ìƒì†ë°›ëŠ”ë‹¤. (Player, Monster, NPC,...)

`BaseController.cs`ëŠ” ìƒíƒœ(`State`)ì— ê´€ë ¨í•œ ê¸°ë³¸ ê¸°ëŠ¥ì„ ê°€ì§€ê³  ìˆë‹¤.

### ì• ë‹ˆë©”ì´ì…˜ ì½”ë“œ
ì• ë‹ˆë©”ì´ì…˜ì„ ì½”ë“œë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ `CrossFade`ë¥¼ ì‚¬ìš©í–ˆìœ¼ë©°

ì• ë‹ˆë©”ì´ì…˜(`CrossFade`)ì€ ìºë¦­í„°ì˜ ìƒíƒœ(`State`)ê°€ ë°”ë€Œë©´ í˜¸ì¶œë˜ë„ë¡ êµ¬í˜„í–ˆë‹¤.
```cs
int number = 1;

[SerializeField]
protected Define.State _state = Define.State.Idle;

public virtual Define.State State
{
    get { return _state; }
    set {
        _state = value;

        // anim.CrossFade(ì¬ìƒ í´ë¦½ ì´ë¦„, ë°”ë€ŒëŠ”ë°ì— ì§€ì—° ì‹œê°„, ë ˆì´ì–´, ì¬ìƒ ì‹œì‘ ì‹œì )
        switch (_state)
        {
            case Define.State.Moving:
                anim.CrossFade("RUN", 0.1f);
                break;
            case Define.State.Idle:
                anim.CrossFade("WAIT", 0.4f);
                break;
            case Define.State.DiveRoll:
                anim.CrossFade("DIVEROLL", 0.1f, -1, 0);
                break;
            case Define.State.Attack:
                // í”Œë ˆì´ì–´ëŠ” ê³µê²© ìƒí™©ì´ ë°”ë€” ìˆ˜ ìˆìœ¼ë‹ˆ Monsterë§Œ ì‚¬ìš©
                if (WorldObjectType == Define.WorldObject.Monster)
                {
                    anim.CrossFade("ATTACK"+number, 0.1f, -1, 0);

                    // ê¸°ë³¸ ê³µê²© ë°©ë²•ì€ ë‘ê°€ì§€ë¡œ ë²ˆê°ˆì•„ë„ë¡ í•¨.
                    if (number == 1)
                        number = 2;
                    else if (number == 2)
                        number = 1;
                }
                break;
            case Define.State.Hit:
                {
                    anim.CrossFade("HIT", 0.1f, -1, 0);
                }
                break;
            case Define.State.Die:
                {
                    anim.CrossFade("DIE", 0.1f, -1, 0);
                }
                break;
        }
    }
}
```