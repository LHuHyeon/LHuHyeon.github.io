---
title: (PlayFab) Azure ìƒ˜í”Œ ì½”ë“œ ë¶„ì„
author: LHH
date: 2023-12-30 12:00 GMT+0900
categories: [Study, PlayFab]
tags: [PlayFab, BaaS, Azure]
---

> ë¶„ì„ ì‚¬ì´íŠ¸ : [PlayFab-Sample : Tic Tac Toe Azure Functions App (Unity Game)](https://github.com/PlayFab/PlayFab-Samples/blob/master/Samples/CSharp/AzureFunctions/TicTacToeFunctions/README.md)

í˜‘ì—…ì— ê²½í—˜ì´ ì—†ì–´ì„œ.. ìƒ˜í”Œ ì½”ë“œì— ìì£¼ ì“°ì´ëŠ” ì½”ë“œë¥¼ ë¶„ì„í•œ ê¸€ì…ë‹ˆë‹¤.

## ê¸°ë³¸ ì§€ì‹ (í˜¹ì‹œë¼ë„!)
ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë¡œ ì†Œí†µí•˜ê¸° ìœ„í•´ ì†¡ìˆ˜ì‹  í•˜ëŠ” ì–‘ì‹ì´ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ì„œ `LoginInfo Class`ë¼ëŠ” ì–‘ì‹ì´ ìˆìœ¼ë©´ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ëª¨ë‘ ê·¸ ì–‘ì‹ì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ì œ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ê°ê° ìì£¼ ì“°ì´ëŠ” íŒ¨í„´ì„ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

## ì„œë²„
### 1. í•„ìˆ˜ ì„¤ì¹˜!
- ì„œë²„ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ê¼­ ì„¤ì¹˜í•´ì£¼ì„¸ìš”!
    - [PlayFab C# SDK](https://www.nuget.org/packages/PlayFabAllSDK/)
    - [PlayFab CloudScript C# Plugin](https://www.nuget.org/packages/PlayFabCloudScriptPlugin/)

<br>

### 2. Server Function Code
ë¨¼ì € ìƒ˜í”Œ ì½”ë“œë¥¼ í™•ì¸í•´ë´…ì‹œë‹¤.
```cs
// Models
public class PlayFabIdRequest
{
    public string PlayFabId { get; set; }
}

public class WinCheckResult
{
    public GameWinnerType Winner { get; set; }
}

// Function
[FunctionName("WinCheck")]
public static async Task<WinCheckResult> Run(
    [HttpTrigger(AuthorizationLevel.Function, "post", Route = null)] HttpRequestMessage entityRequest, ILogger log)
{
    // Extract the context from the incoming request
    var context = await FunctionContext<PlayFabIdRequest>.Create(entityRequest);

    string playFabId = context.FunctionArgument.PlayFabId;

    Settings.TrySetSecretKey(context.ApiSettings);
    Settings.TrySetCloudName(context.ApiSettings);

    // Grab the current player's game state
    var state = await GameStateUtil.GetCurrentGameState(playFabId, context.ApiSettings, context.AuthenticationContext);
    
    var winCheckResult = WinCheckUtil.Check(state);

    if (winCheckResult.Winner != GameWinnerType.NONE)
    {
        // Update the leaderboard accordingly
        await LeaderboardUtils.UpdateLeaderboard(playFabId, winCheckResult.Winner);

        // Store the game history
        await GameStateUtil.AddGameStateHistory(state, playFabId, context.ApiSettings, context.AuthenticationContext);

        // Clear the current game state
        await GameStateUtil.UpdateCurrentGameState(new TicTacToeState(), playFabId, context.ApiSettings, context.AuthenticationContext);
    }

    return winCheckResult;
}
```
<br>

ì½”ë“œì˜ íë¦„ìœ¼ë¡œ ë´¤ì„ ë•ŒëŠ” í”Œë ˆì´ì–´ì˜ Idë¥¼ ìˆ˜ì‹  ë°›ê³  ìŠ¹ë¦¬ ì—¬ë¶€ ìƒíƒœë¥¼ í™•ì¸ í›„ `WinCheckResult`ë¥¼ ì†¡ì‹ í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.

ë¨¼ê°€ ì–´ë µê³  ë³µì¡í•´ ë³´ì´ì§€ë§Œ.. ìì£¼ ì“°ì´ëŠ” ì½”ë“œë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.

```cs
[FunctionName("WinCheck")]
public static async Task<WinCheckResult> Run(
    [HttpTrigger(AuthorizationLevel.Function, "post", Route = null)] HttpRequestMessage entityRequest, ILogger log)
{
    // Extract the context from the incoming request
    var context = await FunctionContext<PlayFabIdRequest>.Create(entityRequest);

    string playFabId = context.FunctionArgument.PlayFabId;
}
```
<br>

ìš°ì„  ì°¨ë¡€ì°¨ë¡€ ì½ì–´ë³´ë©´! 
- í•¨ìˆ˜ì˜ ë°˜í™˜ê°’ì€ `WinCheckResult`

- `post` ì†¡ìˆ˜ì‹ í•˜ê¸° ë•Œë¬¸ì— `Request`ë¥¼ `HttpRequestMeeage`ë¡œ ì‚¬ìš©

- `context`ì— ìˆ˜ì‹  ìš”ì²­ëœ `PlayFabIdRequest` ì–‘ì‹ì„ ì¶”ì¶œ

- `context`ì—ì„œ `playFabId` ì¶”ì¶œ

ìƒ˜í”Œ Function ì½”ë“œê°€ ëŒ€ë¶€ë¶„ ì´ë ‡ê²Œ ì‹œì‘í•©ë‹ˆë‹¤!

ì œì¼ í•„ìš”í•œ í”Œë ˆì´ì–´ì˜ IDë¥¼ ì¶”ì¶œí–ˆìœ¼ë‹ˆ ìƒí™©ì— ë§ê²Œ ì‚¬ìš©í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

<br>

### 3. íŒ¨í„´
í´ë”ë‚˜ ì½”ë“œ íŒ¨í„´ì€ ì‚¬ëŒë§ˆë‹¤ ë‹¤ë¥´ì§€ë§Œ ìƒ˜í”Œ ì½”ë“œê°™ì€ ê²½ìš° í´ë”ê°€ `Functions, Models, Util`ë¡œ ë‚˜ë‰˜ì–´ì ¸ ìˆì—ˆìŠµë‹ˆë‹¤.

ì°¸ê³ í•˜ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”! :D
- `Functions` : í´ë¼ì´ì–¸íŠ¸ë¡œ ë¶€í„° ìš”ì²­ë°›ì„ í•¨ìˆ˜ê°€ ìˆëŠ” í´ë”

- `Models` : ë³€ìˆ˜, íƒ€ì…ì„ ë‹´ëŠ” í´ë˜ìŠ¤ í´ë”

- `Util` : ì„œë²„ì•ˆì—ì„œ ì—°ì‚°ì„ ìˆ˜í–‰í•  ê¸°ëŠ¥ í´ë”

<br>

## í´ë¼ì´ì–¸íŠ¸
Unity í´ë¼ì´ì–¸íŠ¸ ê°™ì€ ê²½ìš° ìì£¼ ì“°ì´ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

### 1. Client Code
```cs
// ìˆ˜ì‹ í•  ì •ë³´ ì‘ì„±
var request = new ExecuteFunctionRequest
{
    FunctionName = "í•¨ìˆ˜ ì´ë¦„",
    FunctionParameter = new PlayFabIdRequest    // ìì²´ ì–‘ì‹
    {
        PlayFabId = "PlayFab ID"
    },
    AuthenticationContext = new PlayFabAuthenticationContext
    {
        EntityToken = "PlayFab EntityToken"
    }
};

// ë°œì†¡!
PlayFabCloudScriptAPI.ExecuteFunction(request,
    (result) =>
    {
        ExecutionCompleted = true;
    },
    (error) =>
    {
        throw new Exception($"WinCheck request failed. Message: ${error.ErrorMessage}, Code: ${error.HttpCode}");
    });
```

<br>

## ë§ˆë¬´ë¦¬
ì € ê°™ì€ ê²½ìš° ìƒ˜í”Œì½”ë“œë¥¼ ê°„ë‹¨í•˜ê²Œ ë¶„ì„í•´ë³´ë©´ì„œ ì²˜ìŒì˜ ë§‰ë§‰í–ˆë˜ ë§ˆìŒì´ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤. 

ì´ë˜ì„œ ìƒ˜í”Œì½”ë“œ ë³´ëŠ”êµ¬ë‚˜ ì‹¶ê³  ê·¸ëŸ¬ë„¤ìš”..! ê¸€ì´ ìì„¸í•˜ì§„ ëª»í–ˆì§€ë§Œ ë§í¬íƒ€ê³  ë“¤ì–´ê°€ì…”ì„œ ë³´ì‹œë©´ ë„ì›€ì´ ë ê²ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤ :D

<br>

## ğŸ’¡ ì°¸ê³ 
- [PlayFab-Sample : Tic Tac Toe Azure Functions App (Unity Game)](https://github.com/PlayFab/PlayFab-Samples/blob/master/Samples/CSharp/AzureFunctions/TicTacToeFunctions/README.md){:target="_blank"}