---
title: (C#) ì†Œì¼“ í”„ë¡œê·¸ë˜ë° ê¸°ì´ˆ
author: LHH
date: 2023-03-07 20:50 GMT+0900
categories: [Study, C# Rookiss Part4 ê²Œì„ì„œë²„]
tags: [Rookiss ê°•ì˜, C#, Server, Socket, ì†Œì¼“ ê¸°ì´ˆ]
---

ì†Œì¼“ í”„ë¡œê·¸ë˜ë°ì˜ ê¸°ì´ˆì ì¸ ì½”ë“œë¥¼ ì§œê³  ì ì‘í•´ë³¸ë‹¤.

## ğŸ’» ì½”ë“œ
### Server Code
ë¨¼ì € DNSë¥¼ í™œìš©í•´ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ê°€ì ¸ì™€ IP ì£¼ì†Œë¡œ ë°”ê¿”ì¤€ë‹¤.

ë°”ê¿”ì¤€ IP ì£¼ì†Œë¥¼ ê°€ì§€ê³  IPEndPointì— í¬íŠ¸ë²ˆí˜¸ì™€ í•¨ê»˜ endPointë¥¼ ìƒì„±í•œë‹¤.

ê·¸ ë‹¤ìŒ ì†Œì¼“ ìƒì„±ì„ ìœ„í•´ endPointì™€ í•¨ê»˜ TCP ëª¨ë“œë¡œ listenSocketì„ ìƒì„±í•´ì¤€ë‹¤.
```cs
// DNS (Domain Name System)
string host = Dns.GetHostName();
IPHostEntry ipHost = Dns.GetHostEntry(host);
IPAddress ipAddress = ipHost.AddressList[0];
IPEndPoint endPoint = new IPEndPoint(ipAddress, 5000);

// ë¬¸ì§€ê¸° ( SocketType.Stream, ProtocolType.Tcp ëŠ” ê±°ì˜ ë¬¶ìŒìœ¼ë¡œ ì‚¬ìš©í•œë‹¤. )
Socket listenSocket = new Socket(endPoint.AddressFamily, SocketType.Stream, ProtocolType.Tcp);
```
<br>

ë°”ì¸ë“œë¥¼ ì§„í–‰í•˜ê³  ìµœëŒ€ ëŒ€ê¸°ìˆ˜ë¥¼ ì„¤ì •í•œë‹¤.
```cs
// ë¬¸ì§€ê¸° êµìœ¡
listenSocket.Bind(endPoint);

// ì˜ì—… ì‹œì‘
// backlog = ìµœëŒ€ ëŒ€ê¸°ìˆ˜
listenSocket.Listen(10);
```
<br>

ë³¸ê²©ì ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì˜ ì…ì¥ì„ ë°›ì„ ì¤€ë¹„ë¥¼ í•œë‹¤.

Accept()ë¥¼ ì§„í–‰í•  ë™ì•ˆì—” ë‹¤ìŒ ì½”ë“œë¡œ ë„˜ì–´ê°€ì§€ ì•Šê³  ë¬´í•œëŒ€ê¸°ë¥¼ í•œë‹¤.

ë§Œì•½ í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ì ‘ì†í•  ê²½ìš° ë‹¤ìŒ ì½”ë“œê°€ ì§„í–‰ëœë‹¤.

í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë°›ì„ ë²„í¼ë¥¼ ìƒì„±í•´ì£¼ê³ , Receive()ë¥¼ í†µí•´ ë°›ì•„ì¤€ë‹¤.

ë°›ì€ ë°ì´í„°ëŠ” UTF8 ì¸ì½”ë”©ì„ í•´ì¤€ë‹¤.

ê·¸ ë‹¤ìŒ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì…ì¥ ëë‹¤ê³  ì•Œë ¤ì¤˜ì•¼í•˜ê¸° ë•Œë¬¸ì—

ë³´ë‚´ì¤„ string ë²„í¼ë¥¼ ìƒì„±í›„ Send()ë¥¼ ì§„í–‰í•œë‹¤.

ëª¨ë“  ìš©ë¬´ê°€ ëë‚¬ìœ¼ë‹ˆ Shutdown(), Close()ë¥¼ ì§„í–‰í•œë‹¤.
```cs
while (true)
{
    Console.WriteLine("Listening...");

    // ì†ë‹˜ì„ ì…ì¥ì‹œí‚¨ë‹¤. ( í´ë¼ì´ì–¸íŠ¸ê°€ ì…ì¥í•  ë•Œê¹Œì§€ ë¬´í•œ ëŒ€ê¸° )
    Socket clientSocket = listenSocket.Accept();

    // ë°›ëŠ”ë‹¤
    byte[] recvBuff = new byte[1024];
    int recvBytes = clientSocket.Receive(recvBuff);
    string recvData = Encoding.UTF8.GetString(recvBuff, 0, recvBytes);    // ë²„í¼, ë°›ì„ ë°ì´í„° ì‹œì‘ ìœ„ì¹˜, ëª‡ ë§Œí¼ ë°›ì„ì§€
    Console.WriteLine($"[From Client] {recvData}");

    // ë³´ë‚¸ë‹¤
    byte[] sendBuff = Encoding.UTF8.GetBytes("Welcome to LHH Server !!");
    clientSocket.Send(sendBuff);

    // ì«“ì•„ë‚¸ë‹¤
    clientSocket.Shutdown(SocketShutdown.Both);
    clientSocket.Close();
}
```
<br>

í˜¹ì‹œ ëª¨ë¥¼ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ë””ë²„ê¹…í•´ì¤˜ì•¼ ë˜ê¸° ë•Œë¬¸ì—

try, catch ì•ˆì— ë°©ê¸ˆ ì§  ì½”ë“œë¥¼ ë„£ì–´ì¤€ë‹¤.

<details>
<summary> [ Source Code (Click) ] </summary>
<div markdown="1">

```cs
class Program
{ 
    static void Main(string[] args)
    {
        // DNS (Domain Name System)
        string host = Dns.GetHostName();
        IPHostEntry ipHost = Dns.GetHostEntry(host);
        IPAddress ipAddress = ipHost.AddressList[0];
        IPEndPoint endPoint = new IPEndPoint(ipAddress, 5000);

        // ë¬¸ì§€ê¸° ( SocketType.Stream, ProtocolType.Tcp ëŠ” ê±°ì˜ ë¬¶ìŒìœ¼ë¡œ ì‚¬ìš©í•œë‹¤. )
        Socket listenSocket = new Socket(endPoint.AddressFamily, SocketType.Stream, ProtocolType.Tcp);

        try
        {
            // ë¬¸ì§€ê¸° êµìœ¡
            listenSocket.Bind(endPoint);

            // ì˜ì—… ì‹œì‘
            // backlog = ìµœëŒ€ ëŒ€ê¸°ìˆ˜
            listenSocket.Listen(10);

            while (true)
            {
                Console.WriteLine("Listening...");

                // ì†ë‹˜ì„ ì…ì¥ì‹œí‚¨ë‹¤. ( í´ë¼ì´ì–¸íŠ¸ê°€ ì…ì¥í•  ë•Œê¹Œì§€ ë¬´í•œ ëŒ€ê¸° )
                Socket clientSocket = listenSocket.Accept();

                // ë°›ëŠ”ë‹¤
                byte[] recvBuff = new byte[1024];
                int recvBytes = clientSocket.Receive(recvBuff);
                string recvData = Encoding.UTF8.GetString(recvBuff, 0, recvBytes);    // ë²„í¼, ë°›ì„ ë°ì´í„° ì‹œì‘ ìœ„ì¹˜, ëª‡ ë§Œí¼ ë°›ì„ì§€
                Console.WriteLine($"[From Client] {recvData}");

                // ë³´ë‚¸ë‹¤
                byte[] sendBuff = Encoding.UTF8.GetBytes("Welcome to LHH Server !!");
                clientSocket.Send(sendBuff);

                // ì«“ì•„ë‚¸ë‹¤
                clientSocket.Shutdown(SocketShutdown.Both);
                clientSocket.Close();
            }
        }
        catch(Exception ex)
        {
            Console.WriteLine(ex.ToString());
        }
    }
}
```

</div>
</details>

### Client Code
í´ë¼ì´ì–¸íŠ¸ë„ ì„œë²„ì™€ ë¹„ìŠ·í•˜ê²Œ êµ¬í˜„ëœë‹¤.

ì†Œì¼“ ìƒì„±ê¹Œì§€ëŠ” ì„œë²„ì™€ ê°™ë‹¤.
<details>
<summary> [ Source Code (Click) ] </summary>
<div markdown="1">

```cs
string host = Dns.GetHostName();
IPHostEntry ipHost = Dns.GetHostEntry(host);
IPAddress ipAddress = ipHost.AddressList[0];
IPEndPoint endPoint = new IPEndPoint(ipAddress, 5000);

Socket socket = new Socket(endPoint.AddressFamily, SocketType.Stream, ProtocolType.Tcp);
```

</div>
</details>

<br>

í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ì—ê²Œ ì…ì¥ì´ ê°€ëŠ¥í•œì§€ ë¬¼ì–´ë´ì•¼í•˜ê¸° ë•Œë¬¸ì— Connect()ë¥¼ ì§„í–‰í•œë‹¤.

ê·¸ ë‹¤ìŒ ì„œë²„ì—ê²Œ ë³´ë‚´ê³  ì‹¶ì€ ë©”ì‹œì§€ë¥¼ ë°”ì´íŠ¸ë¡œ Send() í•´ì¤€ë‹¤.

ë˜í•œ ë°›ì„ ë©”ì‹œì§€ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì¶©ë¶„í•œ ê³µê°„ì˜ ë²„í¼ ìƒì„± í›„ Receive() í•´ì¤€ë‹¤.

ì„œë²„ì—ì„œ ë‚˜ê°€ë„ë¡ ë„ì™€ì£¼ê² ì§€ë§Œ í˜¹ì‹œ ëª¨ë¥´ë‹ˆ Shutdown(), Close()ë¥¼ ì§„í–‰í•œë‹¤.
```cs
// ì„œë²„ì—ê²Œ ì…ì¥ ë¬¸ì˜
socket.Connect(endPoint);
Console.WriteLine($"Connected To {socket.RemoteEndPoint.ToString()}");

// ë³´ë‚¸ë‹¤
byte[] sendBuff = Encoding.UTF8.GetBytes("Hello World!!");
int sendBytes = socket.Send(sendBuff);

// ë°›ëŠ”ë‹¤
byte[] recvBuff = new byte[1024];
int recvBytes = socket.Receive(recvBuff);
string recvData = Encoding.UTF8.GetString(recvBuff, 0, recvBytes);
Console.WriteLine($"[From Server] {recvData}");

// ë‚˜ê°„ë‹¤
socket.Shutdown(SocketShutdown.Both);
socket.Close();
```
<br>

ì´ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ë˜í•œ ì—ëŸ¬ í™•ì¸ì„ ìœ„í•´ try, catchì— ë„£ì–´ì¤€ë‹¤.
<details>
<summary> [ Source Code (Click) ] </summary>
<div markdown="1">

```cs
static void Main(string[] args)
{
    // DNS (Domain Name System)
    string host = Dns.GetHostName();
    IPHostEntry ipHost = Dns.GetHostEntry(host);
    IPAddress ipAddress = ipHost.AddressList[0];
    IPEndPoint endPoint = new IPEndPoint(ipAddress, 5000);

    // íœ´ëŒ€í° ì„¤ì •
    Socket socket = new Socket(endPoint.AddressFamily, SocketType.Stream, ProtocolType.Tcp);

    try
    {
        // ë¬¸ì§€ê¸°ì—ê²Œ ì…ì¥ ë¬¸ì˜
        socket.Connect(endPoint);
        Console.WriteLine($"Connected To {socket.RemoteEndPoint.ToString()}");

        // ë³´ë‚¸ë‹¤
        byte[] sendBuff = Encoding.UTF8.GetBytes("Hello World!!");
        int sendBytes = socket.Send(sendBuff);

        // ë°›ëŠ”ë‹¤
        byte[] recvBuff = new byte[1024];
        int recvBytes = socket.Receive(recvBuff);
        string recvData = Encoding.UTF8.GetString(recvBuff, 0, recvBytes);
        Console.WriteLine($"[From Server] {recvData}");

        // ë‚˜ê°„ë‹¤
        socket.Shutdown(SocketShutdown.Both);
        socket.Close();
    }
    catch (Exception ex)
    {
        Console.WriteLine(ex.ToString());
    }
}
```

</div>
</details>

## ğŸ” ê²°ê³¼
### Server
![server](https://user-images.githubusercontent.com/110723307/223429971-fbbf6c74-adf5-4a01-9d44-1448c89fd015.PNG)

### Client
![client](https://user-images.githubusercontent.com/110723307/223429931-0fdae587-dc90-4b61-915d-e83101d9f8d4.PNG)

<br>

## ğŸ’¡ ì°¸ê³ 
- [Rookiss ê°•ì˜: Part4 ì„œë²„](https://www.inflearn.com/course/%EC%9C%A0%EB%8B%88%ED%8B%B0-mmorpg-%EA%B0%9C%EB%B0%9C-part4){:target="_blank"}